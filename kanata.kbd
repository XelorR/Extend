;; What to remap, initial keyboard state definition
(defsrc
  grv  1    2    3    4    5    6    7    8    9    0    -    =    bspc
  tab  q    w    e    r    t    y    u    i    o    p    [    ]    \
  caps a    s    d    f    g    h    j    k    l    ;    '    ret
  lsft z    x    c    v    b    n    m    ,    .    /    rsft up
  lctl lmet lalt           spc            ralt rmet rctl left down rght
)

;; Colemak (default) implemented with simple alpha shuffle, requires national US (qwerty) layout to be enabled
(deflayer colemak
  grv  1    2    3    4    5    6    7    8    9    0    -    =    bspc
  tab  q    w    f    p    g    j    l    u    y    ;    [    ]    \
  @esc @a   @r   @s   @t   d    h    @n   @e   @i   @o   '    @ent
  lsft @z   x    c    v    b    k    m    ,    .    /    rsft _
  lctl lmet lalt         @space_nav       ralt rmet rctl _    _    _
)

;; Diktor implemented with simple key remap, requires national RU (–π—Ü—É–∫–µ–Ω) layout to be enabled
(deflayer diktor
  grv  @_1   @_2   3     @_4   @_5   @_6   @_7   @_8   9     0     @star =     bspc
  tab  @_—Ü   @_—å   @_—è   @_,   @_.   @_–∑   @_–≤   @_–∫   @_–¥   @_—á   @_—à   @_—â   \
  @esc @_—É   @_–∏   @_–µ   @_–æ   @_–∞   @_–ª   @_–Ω   @_—Ç   @_—Å   @_—Ä   @_–π   @ent
  lsft @_—Ñ   @_—ç   @_—Ö   @_—ã   @_—é   @_–±   @_–º   @_–ø   @_–≥   @_–∂   rsft  _
  @ctl @met @alt         @space_nav              @ral  @rme  @rct  _     _     _
)

;; Diktor implemented with unicode symbols, requires national US (qwerty) layout to be enabled
;; use with caution, prefer the previous one
(deflayer diktor_unicode
  grv  @1–™   @2–¨   @3‚Ññ   @4%   @5:   @6;   @7-   @8dq  9     0      @star  =     bspc
  tab  @—Ü–¶   @—å—ä   @—è–Ø   @,?   @.!   @–∑–ó   @–≤–í   @–∫–ö   @–¥–î   @—á–ß    @—à–®    @—â–©   \
  @esc @d—É–£  @d–∏–ò  @d–µ–ï  @d–æ–û  @–∞–ê   @–ª–õ   @d–Ω–ù  @d—Ç–¢  @d—Å–°  @d—Ä–†   @–π–ô    @ent
  lsft @—Ñ–§   @—ç–≠   @—Ö–•   @—ã–´   @—é–Æ   @–±–ë   @–º–ú   @–ø–ü   @–≥–ì   @–∂–ñ    rsft   _
  @ctl @met @alt         @space_nav              @ral  @rme  @rct   _      _     _
)

;; standard modless qwerty
(deflayer gaming
  esc  1    2    3    4    5    6    7    8    9    0    -    =    bspc
  tab  q    w    e    r    t    y    u    i    o    p    [    ]    \
  caps a    s    d    f    g    h    j    k    l    ;    '    @ent
  lsft z    x    c    v    b    n    m    ,    .    /    rsft up
  lctl @nav lalt            spc           ralt rmet rctl left down rght
)

;; Extend (navigation/edition/function) layer
(deflayer navigation
 C-A-‚å¶ f1    f2    f3    f4     f5    f6   f7   f8   f9   f10  f11  f12  brk
  @¬´‚Äù  A-f4  C-S-‚Üπ ‚Üπ     C-‚Üπ    @ter  ins  ‚á§    ‚Üë    ‚á•    ‚å¶    bck  fwd  @fav
  ‚éã    ‚Äπ‚åò    ‚Äπ‚å•    @‚éà    ‚Äπ‚áß     ‚éô     @cw  ‚Üê    ‚Üì    ‚Üí    ‚å´    @‚Äî   mltp
  ‚áß‚Ä∫   @undo @cut  @copy @paste @redo ‚å•‚Ä∫   ‚áû    ‚ò∞    ‚áü    ‚§∂    _    üñ±‚Üë
  ‚éà‚Ä∫   ‚åò‚Ä∫  ‚å•‚Ä∫              _                    M-e  _    _    üñ±‚Üê   üñ±‚Üì   üñ±‚Üí
)

(deflayer media
  XX  XX    XX    XX    XX    XX    XX    XX    XX    XX    üîá    üîà‚àí   üîà+   XX
  XX  XX    XX    XX    lrld  XX    XX    XX    XX    XX    XX    ‚óÄ‚óÄ    ‚ñ∂‚ñ∂    ‚ñ∂‚è∏
  XX  XX    XX    XX    XX   @gam   XX    XX    XX    XX    XX    XX    XX
  XX  XX    XX    @cmk  XX    XX    XX    XX    XX    XX    XX    XX    _
 @dr0 @dms  @dp0              XX                XX    XX    XX    _     _     _
)

;; Note on layout switching.
;;
;; My language binding for system layouts:
;; - Ctrl-8 = Qwerty (colemak and diktor_unicode layers depends on it)
;; - Ctrl-9 = –ô—Ü—É–∫–µ–Ω (diktor layer depends on it)
;;
;; In this configuration I heavily rely on C-8 and C-9 shortcuts,
;; which can be set up in KDE Plasma or Windows 11 via system settings.
;;
;; If C-8 snd C-9 are not binded, it is possible to use
;;   Colemak and Diktor unicode version with US layout only.

(defcfg concurrent-tap-hold yes)
(defchordsv2
  ;; switching languages with chords
  (w e) @cmk $hold-time all-released (gaming navigation media)
  (x c) @gam $hold-time all-released (gaming navigation media)
  (i o) @dkt $hold-time all-released (navigation media)
  (, .) @dktu $hold-time all-released (navigation media)
)

;; Variables and other settings
(defvar
  tap-time 200
  hold-time 200

  hold-index 150
  hold-middle 150
  hold-ring 170
  hold-pinky 195
)

(defalias
  ;; navigation "Extend" layer
  space_nav (tap-hold $tap-time $hold-time spc (layer-toggle navigation))
  nav (layer-toggle navigation)

  ;; layer to switch layouts
  esc (tap-hold $tap-time $hold-time esc lctl)
  ent (tap-hold $tap-time $hold-time ret (layer-toggle media))
  z (tap-hold $tap-time $hold-pinky z (layer-toggle media))

  ;; layouts
  cmk (multi (layer-switch colemak) C-8)
  dkt (multi (layer-switch diktor) C-9)
  dktu (multi (layer-switch diktor_unicode) C-8)
  gam (multi (layer-switch gaming) C-8)

  ;; some symbols for Extend
  term (macro lmet 250 S-t e r m i n a l 350 ret 50)
  terr (macro C-8 50 lmet 250 S-t e r m i n a l 350 ret 50 C-9)
  ter (switch
    ((base-layer diktor)) @terr break
    () @term break
  )
  ‚Äî (macro ralt 50 - - -)
  ¬´¬ª (macro C-8 50 ralt 50 S-, S-, 50 ralt 50 S-. S-. 50 left C-9)
  u¬´ (unicode ¬´)
  u¬ª (unicode ¬ª)
  u¬´¬ª (macro @u¬´ 50 @u¬ª 50 left)
  ‚Äú‚Äù (macro ralt 50 S-' S-, 50 ralt 50 S-' S-. 50 left)
  ¬´‚Äù (switch
    ((base-layer diktor_unicode)) @u¬´¬ª break
    ((base-layer diktor)) @¬´¬ª break
    () @‚Äú‚Äù break
  )
  cw (caps-word 2000)
  fav C-S-o
  undo C-z
  cut C-x
  copy C-c
  paste C-v
  redo C-S-v

  ‚éà (one-shot 500 lctl)

  ;; dynamic macro
  dr0 (dynamic-macro-record 0)
  dms dynamic-macro-record-stop
  dp0 (dynamic-macro-play 0)

  ;; colemak modtaps
  a (tap-hold $tap-time $hold-pinky a lmet)
  r (tap-hold $tap-time $hold-ring r lalt)
  s (tap-hold $tap-time $hold-middle s lctl)
  t (tap-hold $tap-time $hold-index t lsft)
  n (tap-hold $tap-time $hold-index n rsft)
  e (tap-hold $tap-time $hold-middle e rctl)
  i (tap-hold $tap-time $hold-ring i ralt)
  o (tap-hold $tap-time $hold-pinky o rmet)

;; Diktor symbols
  _1 (fork 1 S-] (lsft rsft))
  _2 (fork 2 S-m (lsft rsft))
  ;; 3 is the same in –π—Ü—É–∫–µ–Ω
  _4 (fork 4 S-5 (lsft rsft))
  _5 (fork 5 S-6 (lsft rsft))
  _6 (fork 6 S-4 (lsft rsft))
  _7 (fork 7 (unmod -) (lsft rsft))
  _8 (fork 8 S-2 (lsft rsft))
  _—Ü w
  _—å (fork m (unmod ]) (lsft rsft))
  _—è z
  _, (fork S-/ S-7 (lsft rsft))
  _. (fork / S-1 (lsft rsft))
  _–∑ p
  _–≤ d
  _–∫ r
  _–¥ l
  _—á x
  _—à i
  _—â o
  _—É (tap-hold $tap-time $hold-pinky e (multi lmet (layer-while-held colemak)))
  _–∏ (tap-hold $tap-time $hold-ring b (multi lalt (layer-while-held colemak)))
  _–µ (tap-hold $tap-time $hold-middle t (multi lctl (layer-while-held colemak)))
  _–æ (tap-hold $tap-time $hold-index j lsft)
  _–∞ f
  _–ª k
  _–Ω (tap-hold $tap-time $hold-index y rsft)
  _—Ç (tap-hold $tap-time $hold-middle n (multi rctl (layer-while-held colemak)))
  _—Å (tap-hold $tap-time $hold-ring c (multi ralt (layer-while-held colemak)))
  _—Ä (tap-hold $tap-time $hold-pinky h (multi rmet (layer-while-held colemak)))
  _–π q
  _—Ñ (tap-hold $tap-time $hold-pinky a (layer-toggle media))
  _—ç '
  _—Ö [
  _—ã s
  _—é .
  _–± ,
  _–º v
  _–ø g
  _–≥ u
  _–∂ ;
  
  ;; ensure modifiers to work as in colemak
  ctl (multi lctl (layer-while-held colemak))
  met (multi lmet (layer-while-held colemak))
  alt (multi lalt (layer-while-held colemak))
  rct (multi rctl (layer-while-held colemak))
  rme (multi rmet (layer-while-held colemak))
  ral (multi ralt (layer-while-held colemak))

  ;; Unicode symbols for Diktor layout
  ;; Row 1
  –™ (unicode –™)
  1–™ (fork 1 @–™ (lsft rsft))

  –¨ (unicode –¨)
  2–¨ (fork 2 @–¨ (lsft rsft))

  ‚Ññ (unicode ‚Ññ)
  3‚Ññ (fork 3 @‚Ññ (lsft rsft))

  4% (fork 4 S-5 (lsft rsft))

  5: (fork 5 S-; (lsft rsft))

  6; (fork 6 ; (lsft rsft))

  7- (fork 7 (unmod -) (lsft rsft))

  8dq (fork 8 S-' (lsft rsft))

  star (fork S-8 S-- (lsft rsft))

  ;; Row 2
  —Ü (unicode —Ü)
  –¶ (unicode –¶)
  —Ü–¶ (fork @—Ü @–¶ (lsft rsft))

  —å (unicode —å)
  —ä (unicode —ä)
  —å—ä (fork @—å @—ä (lsft rsft))

  —è (unicode —è)
  –Ø (unicode –Ø)
  —è–Ø (fork @—è @–Ø (lsft rsft))

  , (unicode ,)
  ? (unicode ?)
  ,? (fork @, @? (lsft rsft))

  . (unicode .)
  ! (unicode !)
  .! (fork @. @! (lsft rsft))

  –∑ (unicode –∑)
  –ó (unicode –ó)
  –∑–ó (fork @–∑ @–ó (lsft rsft))

  –≤ (unicode –≤)
  –í (unicode –í)
  –≤–í (fork @–≤ @–í (lsft rsft))

  –∫ (unicode –∫)
  –ö (unicode –ö)
  –∫–ö (fork @–∫ @–ö (lsft rsft))

  –¥ (unicode –¥)
  –î (unicode –î)
  –¥–î (fork @–¥ @–î (lsft rsft))

  —á (unicode —á)
  –ß (unicode –ß)
  —á–ß (fork @—á @–ß (lsft rsft))

  —à (unicode —à)
  –® (unicode –®)
  —à–® (fork @—à @–® (lsft rsft))

  —â (unicode —â)
  –© (unicode –©)
  —â–© (fork @—â @–© (lsft rsft))

  ;; Row 3
  —É (unicode —É)
  –£ (unicode –£)
  —É–£ (fork @—É @–£ (lsft rsft))
  d—É–£ (tap-hold $tap-time $hold-pinky @—É–£ (multi lmet (layer-while-held colemak)))

  –∏ (unicode –∏)
  –ò (unicode –ò)
  –∏–ò (fork @–∏ @–ò (lsft rsft))
  d–∏–ò (tap-hold $tap-time $hold-ring @–∏–ò (multi lalt (layer-while-held colemak)))

  –µ (unicode –µ)
  –ï (unicode –ï)
  –µ–ï (fork @–µ @–ï (lsft rsft))
  d–µ–ï (tap-hold $tap-time $hold-middle @–µ–ï (multi lctl (layer-while-held colemak)))

  –æ (unicode –æ)
  –û (unicode –û)
  –æ–û (fork @–æ @–û (lsft rsft))
  d–æ–û (tap-hold $tap-time $hold-index @–æ–û lsft)

  –∞ (unicode –∞)
  –ê (unicode –ê)
  –∞–ê (fork @–∞ @–ê (lsft rsft))

  –ª (unicode –ª)
  –õ (unicode –õ)
  –ª–õ (fork @–ª @–õ (lsft rsft))

  –Ω (unicode –Ω)
  –ù (unicode –ù)
  –Ω–ù (fork @–Ω @–ù (lsft rsft))
  d–Ω–ù (tap-hold $tap-time $hold-index @–Ω–ù lsft)

  —Ç (unicode —Ç)
  –¢ (unicode –¢)
  —Ç–¢ (fork @—Ç @–¢ (lsft rsft))
  d—Ç–¢ (tap-hold $tap-time $hold-middle @—Ç–¢ (multi lctl (layer-while-held colemak)))

  —Å (unicode —Å)
  –° (unicode –°)
  —Å–° (fork @—Å @–° (lsft rsft))
  d—Å–° (tap-hold $tap-time $hold-ring @—Å–° (multi lalt (layer-while-held colemak)))

  —Ä (unicode —Ä)
  –† (unicode –†)
  —Ä–† (fork @—Ä @–† (lsft rsft))
  d—Ä–† (tap-hold $tap-time $hold-pinky @—Ä–† (multi lmet (layer-while-held colemak)))

  –π (unicode –π)
  –ô (unicode –ô)
  –π–ô (fork @–π @–ô (lsft rsft))

  ;; Row 4
  —Ñ (unicode —Ñ)
  –§ (unicode –§)
  —Ñ–§ (tap-hold $tap-time $hold-pinky (fork @—Ñ @–§ (lsft rsft)) (layer-toggle media))

  —ç (unicode —ç)
  –≠ (unicode –≠)
  —ç–≠ (fork @—ç @–≠ (lsft rsft))

  —Ö (unicode —Ö)
  –• (unicode –•)
  —Ö–• (fork @—Ö @–• (lsft rsft))

  —ã (unicode —ã)
  –´ (unicode –´)
  —ã–´ (fork @—ã @–´ (lsft rsft))

  —é (unicode —é)
  –Æ (unicode –Æ)
  —é–Æ (fork @—é @–Æ (lsft rsft))

  –± (unicode –±)
  –ë (unicode –ë)
  –±–ë (fork @–± @–ë (lsft rsft))

  –º (unicode –º)
  –ú (unicode –ú)
  –º–ú (fork @–º @–ú (lsft rsft))

  –ø (unicode –ø)
  –ü (unicode –ü)
  –ø–ü (fork @–ø @–ü (lsft rsft))

  –≥ (unicode –≥)
  –ì (unicode –ì)
  –≥–ì (fork @–≥ @–ì (lsft rsft))

  –∂ (unicode –∂)
  –ñ (unicode –ñ)
  –∂–ñ (fork @–∂ @–ñ (lsft rsft))
)
